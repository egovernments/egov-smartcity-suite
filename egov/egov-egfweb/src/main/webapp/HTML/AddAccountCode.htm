#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
	<head>
		<meta http-equiv = "Content-Type" content="text/html; charset=iso-8859-1">
		<meta http-equiv = "KEYWORDS" content="">
		<meta http-equiv = "DESCRIPTION" content="">
<!-- Inclusion of the CSS files that contains the styles -->
		<link rel=stylesheet href = "../css/egov.css" type = "text/css">
		<SCRIPT LANGUAGE = "javascript" SRC = "../exility/PageManager.js"></SCRIPT>
		<SCRIPT LANGUAGE = "javascript" SRC = "../exility/ExilityParameters.js"></SCRIPT>
		<SCRIPT LANGUAGE = "javascript" SRC = "../exility/PageValidator.js"></SCRIPT>
		<SCRIPT LANGUAGE = "javascript" SRC = "../script/jsCommonMethods.js"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="../exility/CookieManager.js"></SCRIPT>
		<SCRIPT LANGUAGE = "javascript">

		var isIE;
		var completeTable;
		var req,codeArray;
		var j=-1;
		var code;

		function ButtonPress(name){
			document.getElementById('egUser_id').value = CookieManager.getCookie('currentUserId');
			//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //
			if(!isValidUser(1, CookieManager.getCookie('userRole')) ) return false;
			if(!PageValidator.validateForm()){ return false;}

			var glcode2 = document.getElementById("chartOfAccounts_glCode2").value ;
			if(glcode2.length==0) return ;
			if(glcode2.length != code.length) {
				alert('Account code length should be '+code.length);
				document.getElementById("chartOfAccounts_glCode2").value='';
				document.getElementById("chartOfAccounts_glCode2").focus();
				return false;
				}


			document.getElementById('chartOfAccounts_name').value=document.getElementById('chartOfAccounts_name1').value;
			document.getElementById("chartOfAccounts_glCode").value=document.getElementById("chartOfAccounts_glCode1").value + document.getElementById("chartOfAccounts_glCode2").value;
			document.getElementById("chartOfAccounts_classification").value=document.getElementById("chartOfAccounts_classification1").value;

			PageManager.UpdateService.submitForm('chartOfAccountsInsertion');

		}

		function onClickCancel(){
			window.location="AddAccountCode.htm?showMode=insert&actionId="+document.getElementById("actionId").value;
		}

		function afterUpdateService(dc)
		{
			window.location="DetailCodeEnquiry.htm?chartOfAccounts_glCode="+document.getElementById('chartOfAccounts_glCode').value+"&showMode=added&actionId="+document.getElementById("actionId").value;

		}

		function getData(){
			var actionid=PageManager.DataService.getQueryField('actionId');
			if(isNaN(actionid))
				actionid=109;
			document.getElementById("actionId").value=actionid;
			//alert(document.getElementById("actionId").value);
			PageManager.ListService.callListService();
			PageManager.DataService.callDataService('classValue');
			//document.getElementById("displaychartOfAccounts_glCode").focus();
			document.title="Chart of Accounts";
		}

	 	function afterRefreshPage(dc){

		 var active = document.getElementById('isActiveForPosting').value;
				if(active == "1"){
					var activefor = document.getElementById('coa_isActiveForPosting');
					activefor.checked = true;
				}
				if(dc.values['serviceID']=="chartOfAccountFullDetails")
				{
					if(dc.values['chartOfAccounts_funcReqd'])
					{
						var val=dc.values['chartOfAccounts_funcReqd'];
						if(val == "Yes"){
						var activefor = document.getElementById('chartOfAccounts_funcReqd');
						activefor.checked = true;
						}
					}
					var val1=dc.values['chartOfAccounts_accTypeId']
					if(val1 != "0")
					{
					 document.getElementById('chartOfAccounts_accType1').value=val1;
					}

					document.getElementById("chartOfAccounts_parentID").value=dc.values["chartOfAccounts_ID"];
					document.getElementById("chartOfAccounts_ID").value="";

				}
				if(dc.values['serviceID']=="maxGlcode")
				{
					var  maxcode = document.getElementById('chartOfAccounts_glCode2').value;
					var  mincode = document.getElementById('chartOfAccounts_glCode1').value;

					code = maxcode.substring(mincode.length,maxcode.length);

					if(maxcode==mincode){

					code="00";
						var val ="00";
						}
						else{
					if(code == '08' || code == '09')
						var val = parseInt(code,10) + 1;
					else
						var val = parseInt(code) + 1;
						}
					val=val.toString();
					if(val.length == 1)
					 val =  '0'+ val;
					 if(isNaN(val)) {
					 	alert('Invalid Account Code');
					 	window.location="AddAccountCode.htm?&actionId="+document.getElementById("actionId").value;
					 }
					document.getElementById('chartOfAccounts_glCode2').value= val;
					document.getElementById('currentValue').value=document.getElementById('chartOfAccounts_glCode2').value;

				}

		}


		function show_typ()
		{
		   var typeobj=document.getElementById("chartOfAccounts_type").value;
		   if(typeobj=='A'||typeobj=='E'||typeobj=='I'||typeobj=='L')
		   { }
		  else{
		        alert("Its an invalid Type. It can be any one of 'A', 'E', 'I', 'L'");
		        return false;
			   }
		}

	function beforeRefreshPage(dc)
	{
	 if(dc.values['serviceID']=='chartOfAccountFullDetails')
	 {
	 	document.getElementById('displaychartOfAccounts_glCode').value=dc.values['chartOfAccounts_glCode'];
	 	document.getElementById('displaychartOfAccounts_name').value=dc.values['chartOfAccounts_name'];
	 }
	}

		function openSearch(obj){
			 var a    = new Array(2);
			 var classificationValue=document.getElementById('chartOfAccounts_class').value;
			 var sRtn = showModalDialog("Search.html?tableNameForCode=chartofaccounts&lvlNumber="+classificationValue,"","dialogLeft=300;dialogTop=210;dialogWidth=305pt;dialogHeight=300pt;status=no;");
    		 if ( sRtn != '' )
    		 {

				a = sRtn.split("`~");
				var type   = document.getElementById('displaychartOfAccounts_glCode');
				type.value = a[0];
				document.getElementById('chartOfAccounts_glCode1').value=type.value ;
				var type1=document.getElementById('chartOfAccounts_glCode1').value;
				PageManager.DataService.setQueryField('value',type1);
				PageManager.DataService.callDataService('maxGlcode');
				PageManager.DataService.setQueryField('chartOfAccounts_glCode',type.value);
				PageManager.DataService.callDataService('chartOfAccountFullDetails');
				document.chartOfAccounts.chartOfAccounts_glCode1.focus();
			}
		}
		function getAccName(evnt) {
			clearTable(document.getElementById("completeTable"));
				//clearTable(completeTable);
			var code1=document.getElementById('displaychartOfAccounts_glCode').value;
			var subminorvalue=document.getElementById('subMinorValue').value;
			if(code1==''){
				document.chartOfAccounts.displaychartOfAccounts_glCode.focus();
				return false;
			}if(code1.length != subminorvalue){
			  alert('Code length should be '+subminorvalue);
			  document.chartOfAccounts.displaychartOfAccounts_glCode.focus();
			  return false;
			}
			var type   = document.getElementById('displaychartOfAccounts_glCode').value;
			document.getElementById('chartOfAccounts_glCode1').value=type;
			var type1 = document.getElementById('chartOfAccounts_glCode1').value;
			PageManager.DataService.setQueryField('value',type1);
			PageManager.DataService.callDataService('maxGlcode');
			PageManager.DataService.setQueryField('chartOfAccounts_glCode',type);
			PageManager.DataService.callDataService('chartOfAccountFullDetails');
			document.chartOfAccounts.chartOfAccounts_glCode1.focus();
			PageManager.DescService.onblur(evnt);
		}

/*
	We implement AJAX here. The remaining functions are present in script/jsCommonMethods.js.
	Whenever user enters some value this function will be triggered.
*/

function autoCompletion(obj) {

var menu=document.getElementById("menu-popup");
	menu.style.setAttribute("left", "225px");
   	var row,nameCell;
	var currRow=PageManager.DataService.getRow(obj);
	if(codeArray != null)
	{
		//keyCodes Values
		//13 - enter, 8 - backspace, 46 - delete, 40 - down arrow, 38 - up arrow
		if(event.keyCode == 13)	{
		 	document.getElementById('chartOfAccounts_glCode1').focus();
		 	//getAccName(event);
		 	return false;
   		}
   		if((event.keyCode == 8) || (event.keyCode == 46))
			j=-1;
   		while(event.keyCode == 40 && codeArray[0] != null)	{
   			j++;
   			document.getElementById('displaychartOfAccounts_glCode').value=codeArray[j];
  			return false;
   			}
  		while(event.keyCode == 38 && codeArray[0] != null) 	{
   			j--;
    	 	document.getElementById('displaychartOfAccounts_glCode').value=codeArray[j];
     	 	return false;
  			}
   }

	  chartOfAccounts_glCode=document.getElementById('displaychartOfAccounts_glCode').value;
      var classval = document.getElementById('chartOfAccounts_class').value;
      var type='coaSubMinorCode';
       if (chartOfAccounts_glCode == "") {
           clearTable(document.getElementById("completeTable"));
       } else {
            var url = "../commons/Process.jsp?type=" + type+"&classification=" + classval+"&id=" + chartOfAccounts_glCode+ "";
          	var req = initiateRequest();
           req.onreadystatechange = function() {
               if (req.readyState == 4) {
                   if (req.status == 200) {
                   	var codes=req.responseText;
                       paintCodes(codes,document.getElementById("auto-row"),document.getElementById("menu-popup"),document.getElementById("completeTable"));
                     } else {
                      clearTable(document.getElementById("completeTable"));
                   }
               }
           };
                req.open("GET", url, true);
                req.send(null);
       }
   }

	function onClickClose()
	{
		window.location="DetailCodeEnquiry.htm?showMode=view&actionId="+document.getElementById("actionId").value;
	}

	function filterSplKeys(e)
	{
		//alert(e.keyCode);
		if( (e.keyCode>=48 && e.keyCode<=58 )|| (e.keyCode>=97 && e.keyCode<=122)||(e.keyCode>=65 && e.keyCode<=90 )||
			e.keyCode==8 || e.keyCode==127 ||( e.keyCode>=44 && e.keyCode<=47)|| e.keyCode==40 || e.keyCode==41 || e.keyCode==32)
			return true;
		else
		 	return false;
	}


</SCRIPT>
	</head>
	<body bgcolor="#ffffff"  onKeyDown ="CloseWindow(event);" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onload="getData();"><!------------------ Header Begins --------------------->
	<table><tr><td><div id="main"><div id="m2"><div id="m3">
		<form name = "chartOfAccounts">
			<input type="hidden" name="egUser_id" id="egUser_id">
			<input type  = "hidden"       name = "isActiveForPosting"            id = "isActiveForPosting" >
			<input type  = "hidden"       name = "chartOfAccounts_lastModified"  id = "chartOfAccounts_lastModified" >
			<input type  = "hidden"       name = "chartOfAccountDetail_glCodeID" id = "chartOfAccountDetail_glCodeID" >
			<input type = "hidden"        name = "chartOfAccounts_majorHead2"    id = "chartOfAccounts_majorHead2" >
			<input type = "hidden"        name = "chartOfAccounts_levelNumber"   id = "chartOfAccounts_levelNumber" >
			<input type = "hidden"		  name = "chartOfAccounts_parentID"      id="chartOfAccounts_parentID">
			<input type = "hidden"		  name = "modGlCode"                     id="modGlCode">
			<input type="hidden"          name = "chartOfAccounts_group"         id = "chartOfAccounts_group" >
			<input type="hidden"          name = "chartOfAccounts_class"         id = "chartOfAccounts_class">
			<input type="hidden"          name = "chartOfAccounts_classification"         id = "chartOfAccounts_classification" >
			<input type="hidden"          name = "currentValue"         id = "currentValue" >
			<input type="hidden"          name = "subMinorValue"         id = "subMinorValue" >
			<input type="hidden"		name="chartOfAccounts_ID"		id="chartOfAccounts_ID">
			<input type="hidden" name="actionId" id="actionId">
			<input type="hidden" name="chartOfAccounts_glCode" id="chartOfAccounts_glCode">
			<input type="hidden" name="chartOfAccounts_name" id="chartOfAccounts_name">
			<table width = "100%" border=0 cellpadding="6" cellspacing="0">
					<tr>
						<td valign="top"><!------------Content begins here ------------------>
							<table width = "100%" border = 0 cellpadding = "3" cellspacing = "0">
								<tr class="tableheader"><td class = "headerwhite2" colspan="2"><span id="screenName"> Add Account Code</span></td>
									<td  valign = "center" colspan = "1"><td class="tableHeader" colspan="1" valign="center" align="right"><a onclick="newWindow('../HelpAssistance/ChartofAccounts.htm')" ><IMG height=19  src="../images/help.gif"  ></a></td></td></tr>
								<tr >
								    <td width = "25%"  align="right"><div   align="right" valign="middle"  class="labelcell">
                                      Parent Account Code<SPAN class=leadon>*</SPAN> </div></td>
									<td><span class="smallfieldcell">
                                    <input type="text" tabindex="1" name="displaychartOfAccounts_glCode"  class = "fieldinput" id="displaychartOfAccounts_glCode" autocomplete="off" onkeyup="autoCompletion(this);" onBlur="getAccName(event)" exilMustEnter="true" exilDataType="exilAlphaNumeric" size="20">
									<IMG onclick = openSearch(this); height = 22 src="../images/plus1.gif" width=25 align=top border=0>&nbsp;</span></td>
									<td width = "25%" align="right"><div   align="right" valign="middle"    class = "labelcell">
                                      Parent Account Name<span class="leadon">*</span></div></td>
									<td width = "25%">
                                    <!--input name="chartOfAccounts_name" class = "combowidth1" id="chartOfAccounts_name"  readonly onmouseover="this.title=this.value" exilDataType="exilAnyChar" size="20"></td-->
                                     <textarea name="displaychartOfAccounts_name" class = "narrationfieldinput" id="displaychartOfAccounts_name"  readonly onmouseover="this.title=this.value" exilDataType="exilAnyChar" rows="2" cols="20"></textarea></td>
								</tr>
								<tr  >
								<td id="auto-row">&nbsp;<td/>
								<td width="25%" align="right" style=" display:none " ><div class="labelcell" >Classification</div></td>
            					<td width="25%" style=" display:none " ><select  id="chartOfAccounts_classification1" name="chartOfAccounts_classification1" class="fieldinput" disabled >
              								<option></option>
              								<option value="1">1</option>
              								<option value="2">2</option>
              								<option value="3">3</option>
              								<option value="4" selected>4</option>
          								</select></td>
          						<td width = "25%">&nbsp;</td>
          						<td width = "25%">&nbsp;</td>
								</tr>
								<tr  >
								    <td width = "25%"  align="right"><div   align="right" valign="middle"  class="labelcell">Account Code<SPAN class=leadon>*</SPAN> </div></td>
									<td>
                                    <span class="smallfieldcell"><input tabindex="1" name="chartOfAccounts_glCode1"  class = "accfieldinput" id="chartOfAccounts_glCode1" exilMustEnter="true" exilDataType="exilAlphaNumeric" readonly >&nbsp;<input name="chartOfAccounts_glCode2"  class = "dtlfieldinput" id="chartOfAccounts_glCode2" exilMustEnter="true" exilDataType="exilUnsignedDecimal" style="width:25"></span></td>
									<td width = "25%"  align="right"><div   align="right" valign="middle"  class="labelcell">Name<span class="leadon">*</span></div></td>
	    		     				<td width = "25%" >
                                    <!--input tabindex="2" name="chartOfAccounts_name1" class="combowidth1" id="chartOfAccounts_name1" maxlength="150" exilMustEnter="true" exilDataType="exilAnyChar" size="20"></td-->
                                    <textarea tabindex="2" name="chartOfAccounts_name1" class="narrationfieldinput" id="chartOfAccounts_name1" maxlength="150" exilMustEnter="true" exilDataType="exilAnyChar"  onkeypress="return filterSplKeys(event)" rows="1" cols="20"></textarea></td>
								</tr>
								<tr >
									<td width = "25%" style=" display:none "><div       align="right" valign="middle"        class="labelcell">Alternate Name</div></td>
									<td width = "25%" style=" display:none ">
                                    <input     name="chartOfAccounts_alternateName" class="fieldinput" id="chartOfAccounts_alternateName" maxlength="150" exilDataType="exilAnyChar" size="20"></td>
									<td width = "25%" align="right"><div       align="right" valign="middle"        class="labelcell">Description</div></td>
									<td width = "25%">
                                    <TEXTAREA class=narrationfieldinput id=chartOfAccounts_description name=chartOfAccounts_description exilDataType="exilAnyChar" rows="1" cols="20"></TEXTAREA></td>
                                    <td width = "25%">&nbsp;</td>
                                    <td width = "25%">&nbsp;</td>

		    					</tr>
								<tr >

								<td align="right" valign="center" width="25%" style=" display:none "><div align="right" class="labelcell">Type</div></td>
							    <td width="25%" style=" display:none ">
                                <input name="chartOfAccounts_type" class = "fieldinput" id="chartOfAccounts_type" readonly exilDataType="exilAnyChar" onBlur="show_typ()" size="20"></td>
                                <td width="25%"  valign="right" align="right"><span class="labelcell">Budget Check Required</span></td>
                                <td width="25%" ><input type="checkbox" name="budgetCheckReqd" id="budgetCheckReqd" value="ON"></td>
								<td align="right" valign="center" width="25%"><div align="right" class="labelcell">Purpose</div></td>
							    <td width = "25%"><span class="smallfieldcell"><select     name="chartOfAccounts_purpose" class="combowidth1" id="chartOfAccounts_purpose" maxlength="3" exilListSource="acct_purpose" exilDataType="exilUnsignedInt"  >
                                </select></span></td>
							    <td width = "25%">&nbsp;</td>
                                <td width = "25%">&nbsp;</td>
								</tr>

								<tr >
								<td width = "25%"  align="right"><div   align="right" valign="middle" class="labelcell">ActiveForPosting</div></td>
	    		     			<td width = "25%">
                                <input type="checkbox" name="coa_isActiveForPosting" id="coa_isActiveForPosting" checked value="ON"></td>
								<td align="right" valign="center" width="25%"><div align="right" class="labelcell">Account Detail Type</div></td>
							    <td width="25%"><span class="smallfieldcell"><select id="chartOfAccounts_accType1"  class="combowidth1" name="chartOfAccounts_accType1"  exilListSource="acct_type"></SELECT></span></td>
								</tr>

								<tr  >

								<td width = "25%" align="right"><div   align="right" valign="middle" class="labelcell">Function Required</div></td>
	    		     			<td width = "25%">
                                <input type="checkbox" name="chartOfAccounts_funcReqd" id="chartOfAccounts_funcReqd" value="ON"></td>
								<td  colspan=4>&nbsp;</td>
								</tr>


								<tr  width = "25%">
        		                	<td  colspan=4>&nbsp;</td>
                		        </tr>
						</table>
						<table width="100%"  border="0" cellpadding="0" cellspacing="0">
        		           	<tr><td></td></tr>
							<tr >
								<td height="25" colspan="4" valign="bottom" class="smalltext"><p class="smalltext"><span class="leadon">*</span> - Mandatory Fields</p></td>
							</tr><!--  Buttons for Request Form starts here -->
							<tr >
								<td colspan="4" align="middle"><!-- Buttons Start Here -->
									<table border="0" cellpadding="0" cellspacing="0"  align="center">
										 <tr>
										 <td>
										 <input  type="button" class="button" value="Add" onclick="ButtonPress('saveclose');"/>
										 <input   type="button" class="button" value="Cancel" onclick="onClickCancel()" />
										 <input   type="button" class="button" value="Close" onclick=onClickClose(); />
										 </td>
									</tr></table><!-- Buttons End Here -->
								</td>
								</tr>
							</table><!------------ Content ends here ------------------>
						</td>
					</tr>
			  	</table>
		</form>
	</div></div></div></td></tr></table>
				 <div style="position: absolute; top:170px;width:218px;height:40px" id="menu-popup" >
				 <table id="completeTable" bgcolor="#cae1ff" border="1"/>
		 </div>
	</body>
</html>

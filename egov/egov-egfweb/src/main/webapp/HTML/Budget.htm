#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>

<script language="javascript">
function getGridData(){
	var table=document.getElementById('mainTable');
	table.rows[5].style.display="none";
	var typeOfCode=document.getElementById('type_id');
	if(typeOfCode.selectedIndex==-1){
		alert("select Type");
		return;
	}
	PageManager.DataService.setQueryField('filter',typeOfCode.options[typeOfCode.selectedIndex].value);
	PageManager.DataService.callDataService('budgetNewData');
}
function afterRefreshPage(dc){

	var pgMode=PageManager.DataService.getQueryField("pageMode");
	var table=document.getElementById('mainTable');
	if(pgMode=="add"){
		var typeOfCode=document.getElementById('type_id');
		typeOfCode.setAttribute("exilMustEnter","true");
		if(dc.values['serviceID']=='budgetNewData'){
			if(dc.grids['mainData'].length>1){
				table.rows[5].style.display="block";
			}else{
				table.rows[5].style.display="none";
			}
		}
		disableCell('budget_revisedAmount');
		return true;
	}else{
		disableCell('budget_Amount');
	}
	table.rows[3].style.display="none";
	table.rows[5].style.display="block";
	try{
		if(dc.values['serviceID']=='comboFill'){
			PageManager.DataService.callDataService('getFundDeptName');
		}

	}catch(e){}

	return true;
}

function onLoadTasks(){
	PageManager.DataService.addNewRow('mainData');
	PageManager.DataService.callDataService('comboFill');
	var frmMode=document.getElementById('formMode');
	PageValidator.addCalendars();
	var pgMode=PageManager.DataService.getQueryField("pageMode");
	frmMode.value=pgMode;
	var buttonObj=document.getElementById("submitButton");
	var tableObj=document.getElementById("mainData");
	if(pgMode=="modify"){//revise mode
			disableCell('budget_Amount');
			showControls(0);
			buttonObj.innerHTML="Revise";
			PageManager.DataService.callDataService('budgetModData');
	}else{
			showControls(1);
			disableCell('budget_revisedAmount');
			buttonObj.innerHTML="Set";
			//PageManager.DataService.callDataService('budgetNewData');
	}
	insertDates('budget_revisedDate');
}
function showControls(flag){
	var fundDObj=document.getElementById('fund_name');
	var deptDObj=document.getElementById('department_name');

	var fundCObj=document.getElementById('fund_id');
	var deptCObj=document.getElementById('department_id');

	if(flag==0){//show div's
		fundCObj.style.display="none";
		deptCObj.style.display="none";
		fundDObj.style.display="block";
		deptDObj.style.display="block";
	}else{//show combo's for insertion
		fundDObj.style.display="none";
		deptDObj.style.display="none";
		fundCObj.style.display="block";
		deptCObj.style.display="block";
	}

}
function disableCell(objName){
	var obj=document.getElementsByName(objName);
   	for(var i=0;i<obj.length;i++){
   		obj[i].readOnly=true;
   	}
}
function ButtonPress(name){
	//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //
	if(!isValidUser(2, CookieManager.getCookie('userRole')) ) return false;

	if(!PageValidator.validateForm())return;
	if(!validate())return;
	PageManager.UpdateService.submitForm('budgetUpdate');
}
function onClickCancel()
{
window.location="BudgetEnquiry.htm";
}
function afterUpdateService(dc){
	window.location="BudgetEnquiry.htm";
}
function validate(){
	document.getElementById('egUser_id').value = CookieManager.getCookie('currentUserId');
	var pgMode=PageManager.DataService.getQueryField("pageMode");
	if(pgMode=="add"){
				var obj=document.getElementsByName("budget_Amount");
				var fundCombo=document.getElementById("fund_id");
				var departmentCombo=document.getElementById("department_id");
				if(fundCombo.selectedIndex<=0){
					alert("Fund is mandatory");
					fundCombo.focus();
					return false;
				}
				if(departmentCombo.selectedIndex<=0){
					alert("Department is mandatory");
					departmentCombo.focus();
					return false;
				}

	}else{
		var obj=document.getElementsByName("budget_revisedAmount");
		for(var i=0;i<obj.length;i++){
			if(parseInt(obj[i].value)<=0){
				alert("Cant set to zero");
				obj[i].focus();
				return false;
			}
		}
	}
	return true;
}
</script>
</head>
<body bgcolor="#ffffff" onKeyDown ="CloseWindow(event);" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onLoad="onLoadTasks()" >
<form name="budgetSet">
<input type="hidden" name="egUser_id" id="egUser_id">
<input type="hidden" id="formMode" name="formMode">
	<table width="100%" border=0 cellpadding="3" cellspacing="0" id="mainTable"><!------------Content begins here ------------------>
		<tr>
			<td class="rowheader" valign="center" colspan="4"><span id="up" name="up" class="headerwhite2">Budget Allocation</span></td>
		</tr>
		<tr class="row1">
			<td ><div align="right" valign="center" class="normaltext">Financial Period<span class="leadon">*</span></div></td>
			<td>
				<input type=hidden id="budget_financialYearID" name="budget_financialYearID" exilDataType="exilAnyChar">
				<div id="budget_financialYearName" name="budget_financialYearName" class="fieldinput"></div>
			</td>
			<td ><div align="right" valign="center" class="normaltext">Revised Date<span class="leadon">*</span></div></td>
			<td>
				<input name="budget_revisedDate" class="datefieldinput" id="budget_revisedDate" style="WIDTH: 95px; HEIGHT: 19px" exilDataType  ="exilAnyDate"  exilCalendar="true" exilMustEnter="true">
			</td>
       </tr>
       <tr class="row2">
			<td ><div align="right" valign="center" class="normaltext"> Fund<span class="leadon">*</span></div></td>
			<td>
				<input class="fieldinput" id="fund_name" name="fund_name" style="DISPLAY: none" readOnly>
				<select name="fund_id" id="fund_id" class="fieldinput" style="WIDTH: 110px" exilListSource="fund_id">
				</select>
			</td>
			<td ><div align="right" valign="center" class="normaltext"> Function<span class="leadon">*</span></div></td>
			<td>
				<input class="fieldinput" id="department_name" name="department_name" style="DISPLAY: none" readOnly>
	       		<select name="department_id" id="department_id" class="fieldinput"  style="WIDTH: 115px" exilListSource="department_id">
				</select>
			</td>
       </tr>
		<tr class="row1">
			<td ><div align="right" valign="center" class="normaltext"> Type<span class="leadon">*</span></div></td>
			<td>

				<select name="type_id" id="type_id" class="fieldinput" style="WIDTH: 110px" onChange="getGridData()" >
				<option value="" selected
       ></option>
				<option value="1">Income</option>
				<option value="2">Expense</option>
				<option value="3">Liability</option><OPTION
      value=4>Asset</OPTION>
				</select>
			</td>
			<td></td>
			<td></td>
       <tr class="row2" style="HEIGHT: 20px">
		<td></td><td></td><td></td><td></td>
       </tr>

    <tr class="row1" style="DISPLAY: none">
	<td colspan=4>
				<table width="64%" name="mainData" id="mainData" align=center border=1>
					<tr class="rowheader">
						<td width="5%" height=34 class="columnheader"><div align="center" class="columnheader">Account Code</div></td>
                        <td width="15%" class="columnheader"><div align="center">Account Head</div></td>
	                    <td width="10%" class="columnheader"><div align="center">Original&nbsp;Amount</div></td>
	                    <td width="10%" class="columnheader"><div align="center">Revised Amount</div></td>
					</tr>
					<tr>
						<td><input name="chartOfAccounts_code" class="fieldinput" id="chartOfAccounts_code" readOnly style="WIDTH:
            113px; HEIGHT: 22px" size =15 exilDataType="exilAlphaNumeric">
							<input name="chartOfAccounts_id"  id="chartOfAccounts_id" type="hidden" style="WIDTH: 113px; HEIGHT: 22px" size=11 >
						</td>
                        <td>
							<div class="fieldinput" id="chartOfAccounts_name" name="chartOfAccounts_name" readonly       exilTrimLength      ="18" style  ="WIDTH: 120px; HEIGHT: 22px"></div>
		                </td>
	                    <td>
							<input name="budget_id"  id="budget_id" type="hidden" style="WIDTH: 128px; HEIGHT: 22px" size=15>
							<input class="fieldinput-right" id="budget_Amount" name="budget_Amount" maxLength="9" style="WIDTH:
			                 127px; HEIGHT: 22px" size="16"
							 exilDataType="exilUnsignedDecimal" exilMax="999999.99">
	                    </td>
	                    <td>
							<input class="fieldinput-right" id="budget_revisedAmount" name="budget_revisedAmount" maxLength="9" style="WIDTH:
							 121px; HEIGHT: 22px" size="15"
							 exilDataType="exilUnsignedDecimal" exilMax="999999.99">
	                    </td>
					</tr>
				</table>
	</td>
	</tr>
		<tr class="row1">
			<td height="25" colspan="4" valign="bottom" class="smalltext"><p class="smalltext"><span class="leadon">*</span>
				- Mandatory Fields</p>
			</td>
		</tr>

		<tr class="row1">
			<td colspan="4" align="middle"><!-- Buttons Start Here -->
				<table border="0" cellpadding="0" cellspacing="0" align=center>
					<tr>
						<td align="right"><IMG height=18 src="../images/Button_leftside.gif" width=7></td>
						<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary id=submitButton onclick="ButtonPress('saveclose');" href="#">Set</A></td>
						<td><IMG height=18 src="../images/Button_rightside.gif" width=7></td>
						<td><IMG src="../images/spacer.gif" width=8></td>

						<td align="right"><IMG height=18 src="../images/Button_second_leftside.gif" width=6></td>
						<td bgcolor="#ffffff" valign="center" nowrap background="../images/Button_second_middle.gif"><A class=buttonsecondary onclick="onClickCancel()" href="#" >Cancel</A></td>
						<td><IMG height=18 src="../images/Button_second_rightside.gif" width=6></td>
						<td><IMG src="../images/spacer.gif" width=8></td>

						<td align="right"><IMG height=18 src="../images/Button_second_leftside.gif" width=6></td>
						<td bgcolor="#ffffff" valign="center" nowrap background="../images/Button_second_middle.gif"><A class=buttonsecondary href="Home.htm">Close</A></td>
						<td><IMG height=18 src="../images/Button_second_rightside.gif" width=6></td>
					</tr>
				</table>
			</td>
		</tr>
</table><!-- Buttons End Here -->
</form>
</body>
</html>

#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<SCRIPT LANGUAGE="javascript">
var cWind;         // temporary window reference
var count=1;      // Counter which gives number of child windows opened
var cWindows=new Object();    //HashMap where we store child window
var mode="";
var journalType="General";
window.vNum=new Object();
var countOfVnum=0;


function TaskOnload()
{	//window.location=centre;
	PageValidator.addCalendars();


	var smode = PageManager.DataService.getQueryField('showMode');
	//alert(smode);
	document.getElementById('SupConType').setAttribute('exilListSource','SupConTypeList');
	PageManager.DataService.callDataService('getSupConType');
	var table=document.getElementById('POSearchGrid');
	table.style.display="block";
	PageManager.DataService.callDataService('finYearDate');



}

function openSearchFrom(obj)
{
	 var a = new Array(2);
	 var sRtn = showModalDialog("Search.html?tableNameForCode=worksDetail","","dialogLeft=300;dialogTop=210;dialogWidth=305pt;dialogHeight=300pt;status=no;");
	 if ( sRtn != '' )
	   {
	   	 a = sRtn.split("`~`");
		var x =PageManager.DataService.getControlInBranch(obj.parentNode,'worksDetail_codeToSearch1');
		x.value = a[0];

	//added by iliyaraja
		//alert(a[0]);
		var arr=new Array(2);
		arr=a[0].split(",");
		document.getElementById("worksDetail_codeToSearch1").value=arr[0];
		document.getElementById("worksDetail_SearchId").value=arr[2];
	  }
 }


function SupConTypeChange()
		 {
				var obj=document.getElementById('SupConType');
				if(obj.selectedIndex==-1)return;
				var text=obj.options[obj.selectedIndex].value;
			PageManager.DataService.setQueryField('SupConTypeCode',text);
			PageManager.DataService.callDataService('getSupConName');
		 }

function getData()
{
	hideColumn(1);
	//alert(document.getElementById("worksDetail_SearchId").value);
	//alert(document.getElementById("worksDetail_codeToSearch1").value);
	//PageManager.DataService.setQueryField('worksDetail_codeToSearch',document.getElementById('worksDetail_SearchId').value);
	PageManager.DataService.setQueryField('worksDetail_codeToSearch',document.getElementById('worksDetail_codeToSearch1').value);
	var obj =document.getElementById('SupConName');
	if (obj.selectedIndex==-1) name='';
	else{
		var name = obj.options[obj.selectedIndex].text;
		}
		var obj1=document.getElementById('SupConType');
	if(obj1.selectedIndex==-1)
		{
			alert("Enter for TYPE");
			return;
		}

		PageManager.DataService.setQueryField('SupConName1',name);
		PageManager.DataService.setQueryField('SupConType1',document.getElementById('SupConType').value);
		PageManager.DataService.setQueryField('POFromDate1',formatDate1(document.getElementById('POFromDate').value));
		PageManager.DataService.setQueryField('POToDate1',formatDate1(document.getElementById('POToDate').value));

		PageManager.DataService.callDataService('worksDetailData1');

		//added by iliyaraja
	var table=document.getElementById('searchPODetailGrid');
	table.style.display="block";
}

/*function beforeRefreshPage(dc)
{
var tabObj=dc.grids['POSearchGrid'];
		if(!tabObj)		return false;
		if(tabObj.length<2){
			alert("No Data");
		}
		for(var i=1;i<tabObj.length;i++){
				tabObj[i][2]=formatDate(tabObj[i][2]);
		}

		return true;
}
*/


function afterRefreshPage(dc)
	{
		if(dc.values['serviceID']=='finYearDate')
		{
			var dt=dc.values['startFinDate']
			dt=formatDate2(dt);
			document.getElementById('POFromDate').value=dt;
		}
		//hideColumn(1);
		var table=document.getElementById('POSearchGrid');
		//if(table.rows.length>2)
		addSlNo();

	var tabObj=dc.grids['POSearchGrid'];
	var tabObj1=document.getElementById("POSearchGrid");
			if(!tabObj)		return false;
			if(tabObj.length<2){
				alert("No Data ");
				return;
			}


			for(var i=1;i<tabObj.length;i++)
			{
					var obj=PageManager.DataService.getControlInBranch(tabObj1.rows[i],"worksDetail_orderDate");
					obj.innerHTML=formatDate(tabObj[i][4]);
					var sanctionNo=PageManager.DataService.getControlInBranch(tabObj1.rows[i],"worksDetail_sanctionno");
					if (sanctionNo.innerHTML=="")
					    sanctionNo.innerHTML="-";
			}

  }

function hideColumn(index){
	var table=document.getElementById('POSearchGrid');
   	for(var i=0;i<table.rows.length;i++){
		table.rows[i].cells[index].style.display="none";
   	}
}

function addSlNo(){
	var slNo=1;
	var tabObj=document.getElementById("POSearchGrid");
	for(var i=1;i<tabObj.rows.length;i++){
		var obj=PageManager.DataService.getControlInBranch(tabObj.rows[i],"slNo");
		obj.innerHTML=slNo;
		slNo++;
	}

}


function getDetails(obj){
	var row=PageManager.DataService.getRow(obj);
	var table=document.getElementById('POSearchGrid');
	type=document.getElementById('SupConType').value;
	//alert(type);
	var POcode1=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex],'worksDetail_ID');
	POcode1=POcode1.innerHTML;
	var mode=PageManager.DataService.getQueryField('showMode');

	//showModalDialog("WorksDetailEnq.htm?worksDetail_codeToSearch="+POcode1+"&showMode="+mode,"","dialogLeft=20pt;dialogTop=20pt;dialogWidth=700pt;dialogHeight=500pt;status=yes;");
	if(mode=='modifyWork')
		cWind=window.open("WorksDetailAdd.htm?worksDetail_code="+POcode1+"&type="+type+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
	else
		cWind=window.open("WorksDetailEnq.htm?worksDetail_code="+POcode1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
		}

function fillDate1(objName)
	{
		PageValidator.showCalendar('selectedDate');
		document.getElementById(objName).value=document.getElementById('selectedDate').value;
		document.getElementById('selectedDate').value = "";
	}


</SCRIPT>

</head>
<body bgcolor="#ffffff" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onLoad=TaskOnload() ><!------------------ Header Begins Begins--------------------->
<form name="POSearch">
<input type=hidden id=reportType name=reportType>
<input type="hidden" name="selectedDate" id="selectedDate">
<input type="hidden" name="worksDetail_SearchId" id="worksDetail_SearchId">
<input type="hidden" name="startFinDate" id="startFinDate">

	<table width="100%" border=0 cellpadding="3" cellspacing="0">
		<tr  width="100%" id="PONoFromLbl">
		  	<td align="right" valign="center"  width="25%" ><div align="right" class="labelcell">PO No. From <span class="leadon"></span></div></td>
		  	<td width="25%">
					<span class="fieldcell"><input name="worksDetail_codeToSearch1" class="fieldinput" id="worksDetail_codeToSearch1" size="10"  exilMustEnter="false" exilDataType="exilAlphaNumeric"></span> <IMG onclick=openSearchFrom(this); height=22 src="../images/plus1.gif"
			         width=25 align=top border=0>
			</td>
			<td></td>
			<td width="25%">
			</td>
		</tr>
		<tr  width="100%" >

			<td align="right" valign="center"  width="25%" ><div align="right" class="labelcell">Type<span class="leadon">*</span></div></td>
		  	<td class="fieldinput" width="25%" >
				<span class="smallfieldcell"><select  id="SupConType"
            class="fieldinput"  name="SupConType"  onChange="SupConTypeChange()" exilMustEnter="true" width ="25%" >
				</select></span>
		  	</td>
		  	<td align="right" valign="center"  width="25%" ><div align="right" class="labelcell">Sup/Con Name<span class="leadon"></span></div></td>
		  	<td class="fieldinput" width="25%" ><span class="smallfieldcell"><select name="SupConName" class="fieldinput" id="SupConName" exilListSource="conSupList"></select></span></td>


		</tr>
		<tr  width="100%">
			<td width="25%"><div align="right" ><div align="right" class="labelcell">PO Date From </div></td>
							  	<td width="25%" >
									<span class="smallfieldcell"><input class="datefieldinput"  name="POFromDate"  id="POFromDate" size=20 onkeyup="DateFormat(this,this.value,event,false,'3')"  size=20 style="width: 114; height: 22"></span>
								    <A onclick="fillDate1('POFromDate')" tabIndex=-1 href=#><IMG tabIndex=-1 src="../images/calendar.gif"></A>
								</td>
		<td width="25%" align="right"><div align="right" class="labelcell">To </div></td>
							  	<td width="25%" >
									<span class="smallfieldcell"><input class="datefieldinput"  name="POToDate"  id="POToDate" size=20 onkeyup="DateFormat(this,this.value,event,false,'3')"   size=20 style="width: 114; height: 22"></span>								<A onclick="fillDate1('POToDate')" tabIndex=-1 href=#><IMG tabIndex=-1 src="../images/calendar.gif"></A>
								</td>

		</tr>
			<tr  width="100%">
			<td colspan="4" align="middle"><!-- Buttons Start Here -->
				<table border="0" cellpadding="0" cellspacing="0" ID="Table1">
					<tr>
						<td><input   type="button" class="button" value="Search" onclick="getData();" /></td>
					</tr>
				</table>
			</td>
		</tr>

	</table>
<!-- grid starts from here -->
	<table width="100%"  border="0" cellpadding="0" cellspacing="0" name="searchPODetailGrid" id="searchPODetailGrid" style="DISPLAY:none">
		<tr  >
			<td>
				<table width="100%" border="1" align="center" cellpadding="0" cellspacing="0" name="POSearchGrid" id="POSearchGrid">
					<tr class="thStlyle">
						<td width="2%" ><div align="center" id="gridk">slNo</div></td>
						<td width="4%" height="34" ><div align="center" >ID</div></td>
						<td width="16%" ><div align="center" id="gridA">PO Code</div></td>
						<td width="20%" ><div align="center" id="gridH">Work Name</div></td>
						<td width="20%" ><div align="center" id="gridB">Con/Sup Name</div></td>
						<td width="13%" ><div align="center" id="gridC">PO Date</div></td>
						<td width="10%" ><div align="center" id="gridD">Total Amount</div></td>
						<td width="15%" ><div align="center" id="gridI">Sanction No</div></td>


				  	</tr>
				 	<tr class="labelcell">
				 		<td><div id="slNo" name="slNo" exilTrimLength="8">&nbsp;</div></td>
						<td><div id="worksDetail_ID" name="worksDetail_ID" exilTrimLength="8">&nbsp;</div></td>
						<td><A onClick="getDetails(this)" class="labelcell" href="#"><div id="POcode" name="POcode" exilTrimLength="50">&nbsp;</div></A></td>
						<td><div id="worksDetail_name" name="worksDetail_name" exilTrimLength="25">&nbsp;</div></td>
						<td><div id="worksDetail_relationId" name="worksDetail_relationId" exilTrimLength="25">&nbsp;</div></td>
						<td><div id="worksDetail_orderDate" name="worksDetail_orderDate" exilTrimLength="17">&nbsp;</div></td>
						<td align="right"><div id="worksDetail_totalValue" name="worksDetail_totalValue" exilTrimLength="20">&nbsp;</div></td>
						<td align="right"><div id="worksDetail_sanctionno" name="worksDetail_sanctionno" exilTrimLength="15">&nbsp;</div></td>

					</tr>
				</table>
			</td>
		</tr>
	</table>
</form>
</body>
</html>


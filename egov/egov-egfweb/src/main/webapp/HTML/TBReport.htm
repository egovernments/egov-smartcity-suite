#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="KEYWORDS" content="">
<meta http-equiv="DESCRIPTION" content="">
<!-- Inclusion of the CSS files that contains the styles -->
<link rel=stylesheet href="../exility/global.css" type="text/css">
<SCRIPT LANGUAGE="javascript" SRC="../exility/PageManager.js"></SCRIPT>
<SCRIPT LANGUAGE="javascript" SRC="../exility/ExilityParameters.js"></SCRIPT>
<SCRIPT LANGUAGE="javascript" SRC="../exility/PageValidator.js"></SCRIPT>
<script language="javascript" src="../script/jsCommonMethods.js"></script>
<SCRIPT type="text/javascript" src="../script/calendar.js" type="text/javascript" ></SCRIPT>

<SCRIPT LANGUAGE="javascript">
var cWind;         // temporary window reference
var count=1;      // Counter which gives number of child windows opened
var cWindows=new Object();    //HashMap where we store child window
var dbTotal=0,crTotal=0;
var startdate="null",rptEndDate="",fId="",snapShotDateTime="";
function onBodyLoad()
{
	PageValidator.addCalendars();
	PageManager.ListService.callListService();
	PageManager.DataService.callDataService('cgNumber');
}
function ButtonPress()
{
	 if(!PageValidator.validateForm())
				return false;
	 rptEndDate=document.getElementById('asOnDate').value;
	 if(rptEndDate.length == 0)
	 {
	   alert("Enter Date");
	   return;
	  }

	var dbDate=document.getElementById('databaseDate').value;
	if(compareDate(formatDateToDDMMYYYY1(rptEndDate),formatDateToDDMMYYYY1(dbDate)) == -1 )
	{
	alert('As on Date should be less than or equal to '+dbDate);
	document.getElementById('asOnDate').focus();
	return false;
	}
	 PageManager.DataService.setQueryField('endDate',formatDate1(rptEndDate));
	 fObj=document.getElementById('trFund_id');
	  fId=fObj.options[fObj.selectedIndex].value;
	  PageManager.DataService.setQueryField('fromFund',fId);
	  PageManager.DataService.setQueryField('toFund',fId);

	 	 /*fsObj=document.getElementById('trFundSource_id');
	 if(fsObj.options[fsObj.selectedIndex].text != "")
	 {
		var fsId=fsObj.options[fsObj.selectedIndex].value;
		PageManager.DataService.setQueryField('fromFundSource',fsId);
		PageManager.DataService.setQueryField('toFundSource',fsId);
		PageManager.DataService.callDataService('trialBalanceReport');
	 }
else{
		PageManager.DataService.callDataService('getMaxFundSourceId');
	 }*/

	 document.getElementById('gridTBReport').style.display='block';
	var rowTotal = document.getElementById('mainTable').rows[6];
	rowTotal.style.display='block';
	document.getElementById('tDr').innerHTML="";
	document.getElementById('tCr').innerHTML="";
	var rowHeader = document.getElementById('mainTable').rows[4];
	rowHeader.style.display='block';
	PageManager.DataService.callDataService('trialBalanceReport');

}

function beforeRefreshPage(dc)
{
	 /*if(dc.values['serviceID']=='getMaxFundId')
	 {
	  var maxFund=dc.values['maxFund'];
	  var minFund=1;
	  PageManager.DataService.setQueryField('fromFund',minFund);
	  PageManager.DataService.setQueryField('toFund',maxFund);
	 }
	 if(dc.values['serviceID']=='getMaxFundSourceId')
	 {
	   var maxFSource=dc.values['maxFundSource'];
	   var minFSource=1;
	   PageManager.DataService.setQueryField('fromFundSource',minFSource);
	   PageManager.DataService.setQueryField('toFundSource',maxFSource);
		 PageManager.DataService.callDataService('trialBalanceReport');
	 }*/
	 if(dc.values['serviceID']=='trialBalanceReport')
	{
	document.getElementById('tDr').innerHTML="";
	document.getElementById('tCr').innerHTML="";
	 var gridData = dc.grids['gridTBReport'];
	 	if(gridData != null)
	 	{
	 		dbTotal=0;crTotal=0;
	 		for(var i=1; i<gridData.length; i++)
	 		{

	 			if(gridData[i][2]==0)
	 				gridData[i][2]="";
	 			else if(gridData[i][3]==0)
	 				gridData[i][3]="";
	 			dbTotal=dbTotal+parseFloat(gridData[i][2] * 1);
	 			crTotal=crTotal+parseFloat(gridData[i][3] * 1);
	 			if(gridData[i][2]!=0)
	 				gridData[i][2]=(gridData[i][2]*1).toFixed(2);
	 			if(gridData[i][3]!=0)
	 				gridData[i][3]=(gridData[i][3]*1).toFixed(2);
	 		}

	 }
  }

}
function afterRefreshPage(dc){
		document.getElementById('tDr').innerHTML=(dbTotal).toFixed(2);
		document.getElementById('tCr').innerHTML=crTotal.toFixed(2);

		if(dc.values['serviceID']=='trialBalanceReport'){
			if(dc.values['endDate'] != null) rptEndDate=formatDateToDDMMYYYY5(dc.values['endDate']);
			if(dc.values['ULBName'] != null) ulbName='<font size=4><b>' + dc.values['ULBName'];
			rptTitle = 'Trial Balance as on '  + rptEndDate;
			document.getElementById('rptHeader').innerHTML = rptTitle;
			document.getElementById('rptHeader').innerHTML = ulbName + '</b></font><br>' + document.getElementById('rptHeader').innerHTML;
	}
		if(dc.values['currDateTime'] != null){
					 snapShotDateTime=dc.values['currDateTime'];
		}
}

/*function addSlNo()
{
	var slNo=1;
	var tabObj=document.getElementById("gridTBReport");
	for(var i=1;i<tabObj.rows.length;i++)
	{
		var obj=PageManager.DataService.getControlInBranch(tabObj.rows[i],"slNo");
		obj.innerHTML=slNo;
		slNo++;
	}

}*/
function getDetails(obj){

	var row=PageManager.DataService.getRow(obj);
	var table=document.getElementById('gridTBReport');
	var glc=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex],"glcode");
		glc=glc.innerHTML;
		if(!isNaN(parseInt(glc,10)))
		//cWind=window.open("GeneralReport.htm?reportType=tb&tbGlCode="+glc+"&fuid="+fId+"&startdate="+startdate+"&enddate="+rptEndDate+"&snapShotDateTime="+snapShotDateTime,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
		cWind=window.open("../Reports/GeneralReport.jsp?reportType=gl&isDrillDown=Y&glCode1="+glc+"&glCode2="+glc+"&fund_id="+fId+"&startDate="+startdate+"&endDate="+rptEndDate+"&snapShotDateTime="+snapShotDateTime+"&submit=submit","","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
		cWindows[count++]=cWind;

}

</SCRIPT>
</head>
<body bgcolor="#ffffff" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onload="onBodyLoad()" onbeforeunload="closeChilds(cWindows,count)" >
<form name="journalVoucher">
<input type="hidden" name="databaseDate"  id="databaseDate">
	<table width="100%" border=0 cellpadding="3" cellspacing="0" id="mainTable">

		<tr>
			<td class="rowheader" valign="center" width="100%" colspan="4"><span id="screenName" class="headerwhite2">Trial Balance</span><span id="partyName" class="headerwhite2"></span></td>
		</tr>

		<tr class="row1" >
			<td><div align="right" valign="center" class="normaltext">Fund<span class="leadon">*</span></div></td>
			<td align="left">
				<SELECT class="fieldinput" id="trFund_id" name="trFund_id" exilMustEnter="true" exilListSource="fundNameList" ></SELECT>
			</td>
			<td><div align="right" valign="center" class="normaltext" >As On Date<span class="leadon">*</span></div></td>
			<td>
				<input name="asOnDate" id="asOnDate" class="datefieldinput" onkeyup="DateFormat(this,this.value,event,false,'3')" exilDataType="exilAnyDate" exilCalendar="true" exilMustEnter="true">
			</td>

		</tr>
		<tr class="row2" colspan="4" >


		</tr>
		<tr class="row2">
			<td colspan="4" align="middle">
				<table border="0" cellpadding="0" cellspacing="0">
					<tr>
						<td align="right">
							<IMG height=18 src="../images/Button_leftside.gif" width=7></td>
						<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary onclick="ButtonPress()" href="#">Search</A></td>
						<td>
							<IMG height=18 src="../images/Button_rightside.gif" width=7></td>
					</tr>
				</table>
			</td>
		</tr>
		<tr class="row2" style="DISPLAY: none">
					<td colspan=4>
						<table width="100%" align=center border="0" cellpadding="0" cellspacing="0" id='hdrRow' name="hdrRow">
							<tr class="row1" height="25">
		          <TD width="95%" ?>
		            <DIV class=displaydata id=rptHeader align=center
		            name="rptHeader">&nbsp;</DIV></TD></tr>
						</table>
					</td>
		</tr>
		<tr class="row2" >
			<td colspan=4>
				<table width="100%" align=center border="1" cellpadding="0" cellspacing="0" id="gridTBReport" name="gridTBReport" style="DISPLAY: none">
					<tr class="rowheader">
						<!--<td width="10%" height="34" class="columnheader"><div align="center" class="columnheader">Sl No</div></td>-->
						<td width="15%" class="columnheader" align="middle">GlCode</td>
						<td width="55%" class="columnheader" align="middle">Narration</td>
						<td width="15%" class="columnheader" align="middle">Debit</td>
						<td width="15%" class="columnheader" align="middle">Credit</td>
					</tr>

					<tr class="row1">
						<!--<td height="24"><div class="normaltext" id="slNo" name="slNo" exilTrimLength="8">&nbsp;</div></td>-->
						<td height="14"><A onClick="getDetails(this)" href="#"><div class="normaltext" name="glcode" id="glcode"></div>&nbsp;</A></td>
						<td height="14"><div class="normaltext" name="accountHead" id="accountHead"></div>&nbsp;</td>
						<td height="14"><div class="normaltext" name="debitAmount" id="debitAmount" align="right"></div>&nbsp;</td>
						<td height="14"><div class="normaltext" name="creditAmount" id="creditAmount" align="right"></div>&nbsp;</td>
					</tr>
				</table>
			</td>
		</tr>
		<tr class="row2" style="DISPLAY: none">
					<td colspan=4>
						<table width="100%" align=center border="1" cellpadding="4" cellspacing="0" id=TABLE1>
							<tr class="row1">
								<td width="70%" align="left" class="normaltext">Total</td>
								<td width="15%" align="right"><div class="normaltext" name="tDr" id="tDr" align="right"></div></td>
								<td width="15%" align="right"><div class="normaltext" name="tCr" id="tCr" align="right"></div></td>
							</tr>

						</table>
					</td>
		</tr>

	</table>
</form>
</body>
</html>
